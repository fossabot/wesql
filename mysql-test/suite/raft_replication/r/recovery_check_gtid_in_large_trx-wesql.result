create table t(id int);
SET @@GLOBAL.DEBUG= 'd, disable_gtid_background_persister';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SET @@GLOBAL.DEBUG= '+d, crash_during_large_trx_binlog_flush2';
insert into t values(1);
ERROR HY000: Lost connection to MySQL server during query
SET @@GLOBAL.DEBUG= 'd, disable_gtid_background_persister';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SET @@GLOBAL.DEBUG= '+d, crash_during_large_trx_binlog_flush';
insert into t values(2);
ERROR HY000: Lost connection to MySQL server during query
SET @@GLOBAL.DEBUG= 'd, disable_gtid_background_persister';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SET @@GLOBAL.DEBUG= '+d, crash_during_large_trx_binlog_flush_slow';
insert into t values(3);
ERROR HY000: Lost connection to MySQL server during query
SET @@GLOBAL.DEBUG= 'd, disable_gtid_background_persister';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-2	
SET @@GLOBAL.DEBUG= '+d, consensus_replication_crash_after_commit';
insert into t values(4);
ERROR HY000: Lost connection to MySQL server during query
SET @@GLOBAL.DEBUG= 'd, disable_gtid_background_persister';
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-3	
insert into t values(100);
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-4	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-4	
set global debug="+d,force_large_trx,force_large_trx_single_ev";
set global debug="+d,crash_before_update_pos";
insert into t values(5);
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-5	
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
set global debug="-d,force_large_trx,force_large_trx_single_ev";
insert into t values(6);
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-6	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-6	
set global debug="-d, force_large_trx,force_large_trx_single_ev";
CREATE TABLE t1 (a int primary key) engine=innodb;
CREATE TABLE t2 (a int primary key) engine=innodb;
CREATE TABLE t3 (a int primary key) engine=innodb;
CREATE TABLE t4 (a int primary key) engine=innodb;
STOP SLAVE SQL_THREAD for channel 'raft_replication_applier';
Warnings:
Warning	1287	'STOP SLAVE' is deprecated and will be removed in a future release. Please use STOP REPLICA instead
SET @@GLOBAL.DEBUG= '+d, crash_in_a_worker';
set global debug="+d,force_large_trx,force_large_trx_single_ev";
set debug = 'd, set_commit_parent_150';
INSERT INTO t1 values (0);
BEGIN;
INSERT INTO t2 values (1),(2),(3);
UPDATE t2 SET a= a+1 WHERE a=3;
COMMIT;
BEGIN;
INSERT INTO t3 values (1),(2),(3);
UPDATE t3 SET a= a+1 WHERE a=3;
COMMIT;
BEGIN;
INSERT INTO t4 values (1),(2),(3);
UPDATE t4 SET a= a+1 WHERE a=3;
COMMIT;
BEGIN;
INSERT INTO t1 values (1),(2),(3);
UPDATE t1 SET a= a+1 WHERE a=3;
COMMIT;
BEGIN;
select * from t1 where a=4;
a
select * from t2 where a=4;
a
select * from t3 where a=4;
a
select * from t4 where a=4;
a
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-10	
START SLAVE SQL_THREAD for channel 'raft_replication_applier';
Warnings:
Warning	1287	'START SLAVE' is deprecated and will be removed in a future release. Please use START REPLICA instead
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-15	
select * from t1;
a
0
1
2
4
select * from t2;
a
1
2
4
select * from t3;
a
1
2
4
select * from t4;
a
1
2
4
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-15	
set debug='';
set global debug="-d,force_large_trx,force_large_trx_single_ev";
DROP TABLES t1,t2,t3,t4;
set global debug="+d,force_large_trx,force_large_trx_single_ev";
set global debug="+d,force_large_trx,force_large_trx_single_ev";
set global debug="+d,crash_after_update_pos_before_apply";
insert into t values(7);
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-17	
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
set global debug="-d,force_large_trx,force_large_trx_single_ev";
insert into t values(8);
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-18	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-18	
set global debug="+d,force_large_trx,force_large_trx_single_ev";
set global debug="+d,crash_after_apply";
insert into t values(9);
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-19	
SET @@GLOBAL.DEBUG= 'd, disable_se_persists_gtid';
set global debug="-d,force_large_trx,force_large_trx_single_ev";
insert into t values(10);
set global debug="+d,force_large_trx,force_large_trx_single_ev";
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-20	
SELECT @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_OWNED;
@@GLOBAL.GTID_EXECUTED	@@GLOBAL.GTID_OWNED
MASTER_UUID:1-20	
SET @@GLOBAL.DEBUG= '';
drop table t;
