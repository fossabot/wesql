INSTALL PLUGIN clone SONAME 'CLONE_PLUGIN';
# Server restart with --consistent-snapshot-archive=true --consistent_snapshot_archive_period=1 --binlog_archive_expire_auto_purge=false --consistent_snapshot_expire_auto_purge=false
# restart: --smartengine=1 --default-storage-engine=smartengine --default-tmp-storage_engine=innodb --serverless=true --consistent_snapshot_archive_period=1 --binlog_archive_expire_auto_purge=false --consistent_snapshot_expire_auto_purge=false
CREATE DATABASE db1;
CREATE TABLE t1(c1 int) ENGINE=SMARTENGINE ;
INSERT INTO t1 values(1);
INSERT INTO t1 values(2);
INSERT INTO t1 values(3);
INSERT INTO t1 values(4);
SELECT * FROM t1;
c1
1
2
3
4
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` int DEFAULT NULL
) ENGINE=SMARTENGINE DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci
#
# Check for contain innodb_archive consistent_snapshot.index
Pattern found.
# Check for contain se_archive consistent_snapshot.index
Pattern found.
# Select mysql innodb persistent views
include/assert.inc [1st mysql innodb archive file should be innodb_archive_000001.]
include/assert.inc [mysql pesistent innodb archive file exist.]
# Select smartengine persistent views
include/assert.inc [1st smartengine archive file should be se_archive_000001.]
include/assert.inc [smartengine pesistent archive file exist.]
# Select binlog persistent views
include/assert.inc [1st binlog archive file should be binlog.000001.]
# Purge persistent snapshot by timestamp
SELECT * FROM INFORMATION_SCHEMA.CONSISTENT_PERSISTENT_SNAPSHOT_INDEX;
include/assert.inc [Purge consistent snapshot.]
include/assert.inc [Check results after purge.]
# Purge persistent snapshot
include/assert.inc [Purge consistent snapshot.]
SELECT * FROM INFORMATION_SCHEMA.CONSISTENT_PERSISTENT_SNAPSHOT_INDEX;
# Cleanup
DROP DATABASE db1;
