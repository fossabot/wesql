# Consistent snapshot, change log-bin and consistent snapshot recovey.
CREATE DATABASE db1;
CREATE TABLE t1(c1 int) ENGINE=SMARTENGINE ;
INSERT INTO t1 values(1);
INSERT INTO t1 values(2);
FLUSH logs;
INSERT INTO t1 values(3);
FLUSH logs;
INSERT INTO t1 values(4);
FLUSH logs;
SELECT * FROM t1;
c1
1
2
3
4
show binary logs;
Log_name	File_size	Encrypted
master-bin.000001	#	#
master-bin.000002	#	#
master-bin.000003	#	#
master-bin.000004	#	#
SELECT Log_name from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILE_INDEX;
Log_name
binlog.000001
binlog.000002
binlog.000003
# Shutdown server
# Force rmdir datadir for recovery test
# Create an empty data directory...
# Recovery start from object store, and change log-bin=/u01/build/mysql-test/var/tmp/custom-binlog
# restart
INSERT INTO t1 values(5);
SELECT * FROM t1;
c1
1
2
3
4
5
show binary logs;
Log_name	File_size	Encrypted
custom-binlog.000003	#	#
custom-binlog.000004	#	#
custom-binlog.000005	#	#
SELECT Log_name from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILE_INDEX;
Log_name
binlog.000001
binlog.000002
binlog.000003
binlog.000004
binlog.000005
binlog.000006
# Shutdown server
# Force rmdir datadir for recovery test
# Create an empty data directory...
# Recovery start from object store, and change log-bin=master-bin
# restart
SELECT * FROM t1;
c1
1
2
3
4
5
show binary logs;
Log_name	File_size	Encrypted
master-bin.000006	#	#
master-bin.000007	#	#
SELECT Log_name from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILE_INDEX;
Log_name
binlog.000001
binlog.000002
binlog.000003
binlog.000004
binlog.000005
binlog.000006
binlog.000007
DROP TABLE t1;
DROP DATABASE db1;
