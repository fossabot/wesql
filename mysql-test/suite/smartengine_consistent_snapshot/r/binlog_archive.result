# Binlog persist to object store
# Create binlog local archive tmp path
# Create object store
# Create object store bucket
# Server restart with --binlog-archive=true
# restart: --smartengine=1 --default-storage-engine=smartengine --binlog-archive=true --mysql-archive-dir=archive_dir --persistent_on_objstore=true --objstore_provider=local --objstore_region=objstore_dir --objstore_bucket=bucket1
CREATE DATABASE db1;
CREATE TABLE t1(c1 int) ENGINE=SMARTENGINE ;
INSERT INTO t1 values(1);
INSERT INTO t1 values(2);
FLUSH logs;
INSERT INTO t1 values(3);
FLUSH logs;
INSERT INTO t1 values(4);
FLUSH logs;
SELECT * FROM t1;
c1
1
2
3
4
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` int DEFAULT NULL
) ENGINE=SMARTENGINE DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci
show binary logs;
Log_name	File_size	Encrypted
binlog.000001	#	#
binlog.000002	#	#
binlog.000003	#	#
binlog.000004	#	#
SELECT Log_name from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILE_INDEX;
Log_name
binlog.000001
binlog.000002
binlog.000003
SELECT SUBSTRING_INDEX(REPLACE(Log_name, '/', ' '),  ' ', -1) as log from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILES order by log;
log
binlog.000001
binlog.000002
binlog.000003
#
# Object store archive binlog
#
binlog.000001
binlog.000002
binlog.000003
# Binlog local archive, not persist object store
# restart: --smartengine=1 --default-storage-engine=smartengine --binlog-archive=true --mysql-archive-dir=archive_dir
FLUSH logs;
FLUSH logs;
show binary logs;
Log_name	File_size	Encrypted
binlog.000001	#	#
binlog.000002	#	#
binlog.000003	#	#
binlog.000004	#	#
binlog.000005	#	#
binlog.000006	#	#
SELECT Log_name from INFORMATION_SCHEMA.BINLOG_PERSISTENT_FILE_INDEX;
Log_name
binlog.000001
binlog.000002
binlog.000003
binlog.000004
binlog.000005
#
# Local archive binlog
#
binlog.000001
binlog.000002
binlog.000003
binlog.000004
binlog.000005
DROP DATABASE db1;
