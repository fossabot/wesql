--source suite/smartengine/include/have_smartengine.inc

SET SQL_LOG_BIN=0;

create table aaa (id int primary key, i int) ENGINE = SMARTENGINE;

SET GLOBAL smartengine_flush_log_at_trx_commit=0;
--exec sleep 30
select variable_value into @a from performance_schema.global_status where variable_name='smartengine_wal_synced';
insert aaa(id, i) values(1,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';
insert aaa(id, i) values(2,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';
insert aaa(id, i) values(3,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';

SET GLOBAL smartengine_flush_log_at_trx_commit=1;
insert aaa(id, i) values(4,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';
insert aaa(id, i) values(5,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';
insert aaa(id, i) values(6,1);
select variable_value-@a from performance_schema.global_status where variable_name='smartengine_wal_synced';

SET GLOBAL smartengine_flush_log_at_trx_commit=0;
insert aaa(id, i) values(7,1);

let $status_var=smartengine_wal_synced;
let $status_var_value=`select @a+3`;
source include/wait_for_status_var.inc;

truncate table aaa;

# Cleanup
drop table aaa;
SET GLOBAL smartengine_flush_log_at_trx_commit=1;

--source suite/smartengine/include/check_smartengine_log_error.inc
