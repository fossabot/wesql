--source suite/smartengine/include/have_smartengine.inc
--let $sync_count1= `show status like '%smartengine_wal_synced%'`

use test;
create table t0 (id int, data  char(20), primary key(id));

#
# smartengine_flush_log_at_trx_commit=2, sync every second.
#

#set global smartengine_flush_threads=5;
#set global smartengine_compaction_threads=10;
set global smartengine_flush_log_at_trx_commit=2;

show variables like 'smartengine_flush_threads';
show variables like 'smartengine_compaction_threads';
show variables like 'smartengine_flush_log_at_trx_commit';
select sleep(2);

--let $sync_count2= `show status like '%smartengine_wal_synced%'`
--let $assert_cond= "$sync_count2" > "$sync_count1"
--let $assert_text= sync count should grow.
#--echo $sync_count1
#--echo $sync_count2

#
# smartengine_flush_log_at_trx_commit=1, sync when commit.
#

#set global smartengine_flush_threads=3;
#set global smartengine_compaction_threads=7;
set global smartengine_flush_log_at_trx_commit=1;

show variables like 'smartengine_flush_threads';
show variables like 'smartengine_compaction_threads';
show variables like 'smartengine_flush_log_at_trx_commit';
insert into t0 values(0, '123456');

--let $sync_count3= `show status like '%smartengine_wal_synced%'`
--let $assert_cond= "$sync_count3" > "$sync_count2"
--let $assert_text= sync count should grow.
#--echo $sync_count2
#--echo $sync_count3

#
# smartengine_flush_log_at_trx_commit=0, don't sync.
#

#set global smartengine_flush_threads=2;
#set global smartengine_compaction_threads=5;
set global smartengine_flush_log_at_trx_commit=0;

show variables like 'smartengine_flush_threads';
show variables like 'smartengine_compaction_threads';
show variables like 'smartengine_flush_log_at_trx_commit';
insert into t0 values(1, '123456');

--let $sync_count4= `show status like '%smartengine_wal_synced%'`
--let $assert_cond= "$sync_count4" = "$sync_count3"
--let $assert_text= sync count should not grow.
#--echo $sync_count3
#--echo $sync_count4

set global smartengine_flush_log_at_trx_commit=1;

drop table t0;
--source suite/smartengine/include/check_smartengine_log_error.inc
